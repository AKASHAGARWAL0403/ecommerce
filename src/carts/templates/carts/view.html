{% extends "base.html" %}


<script>
{% block jquery %}
$(".item-qty").change(function(){
	//$(this).next(".btn-update").fadeIn();
	item_id = $(this).prev('input[type=hidden]').val();
	qty = $(this).val()
	var data = {
		"item" : item_id,
		"qty" : qty
	}
	$.ajax({
		type:'GET',
		url: {% url 'carts' %},
		data : data,
		success : function(data){
			console.log(data)
			if(data.deleted)
			{
				$("#item-"+item_id).fadeOut();
				$('#sub-total').text(data.total)	
				updateItemCount()		
			}
			else
			{
				$('#line-total-'+item_id).text(data.line_total)
				$('#sub-total').text(data.total)
				updateItemCount()				
			}

		},
		error : function(response,error){
			$('#add-form').submit()
		}
	})
});

{% endblock %}
</script>

{% block content %}


<table class='table'> 

{% for item in objects.cartitem_set.all %}

	<tr id='item-{{item.item.id}}'>
		<td>{{ item.item.get_title }}</td>
		<td>
		<form action="." method="GET" >
		<input type='hidden' name='item' value='{{ item.item.id }}' />
		<input type='number' class='item-qty' name='qty' value='{{ item.quantity }}' /><input type='submit' class='btn-update btn btn-link' value='Update item' style='display:none;'/>
		</form></td>
		<td id='line-total-{{ item.item.id }}' >{{ item.line_item_total }}</td>
		<td class='text-right' ><a href='{{ item.remove }}'>X</a></td>
	</tr>

{% endfor %}


<tr>
<td colspan='4' class='text-right' id="sub-total">Subtotal: {{ objects.sub_total }}</td>

</tr>

</table>
{% endblock %}